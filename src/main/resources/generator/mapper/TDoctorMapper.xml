<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.himwei.testtemplatebackend.mapper.TDoctorMapper">

    <resultMap id="BaseResultMap" type="com.himwei.testtemplatebackend.model.entity.TDoctor">
            <id property="id" column="id" />
            <result property="userId" column="user_id" />
            <result property="deptId" column="dept_id" />
            <result property="title" column="title" />
            <result property="price" column="price" />
        <result property="updateTime" column="update_time"/>
            <result property="intro" column="intro" />
            <result property="createTime" column="create_time" />
    </resultMap>

    <sql id="Base_Column_List">
        id,user_id,dept_id,title,price,intro,
        create_time,update_time
    </sql>

    <select id="selectDoctorVOPage" resultType="com.himwei.testtemplatebackend.model.vo.DoctorVO">
        SELECT
        d.id,
        d.dept_id AS deptId,
        u.nickname AS doctorName,
        u.avatar,
        dep.dept_name AS deptName,
        d.title,
        d.price,
        d.intro
        FROM t_doctor d
        LEFT JOIN sys_user u ON d.user_id = u.id
        LEFT JOIN t_department dep ON d.dept_id = dep.id
        <where>
            u.deleted = 0
            <!-- 注意这里: query.deptId -->
            <if test="query.deptId != null">
                AND d.dept_id = #{query.deptId}
            </if>
            <!-- 注意这里: query.keyword -->
            <if test="query.keyword != null and query.keyword != ''">
                AND (
                u.nickname LIKE concat('%', #{query.keyword}, '%')
                OR d.intro LIKE concat('%', #{query.keyword}, '%')
                )
            </if>
        </where>
        ORDER BY d.id ASC
    </select>
</mapper>
